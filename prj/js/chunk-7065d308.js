(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7065d308"],{"4e54":function(t,e,n){},"872c":function(t,e,n){"use strict";n("3a20"),n("7267");var a=n("c451"),r=(n("6bf2"),n("5013"),{});e["a"]={data:function(){return{users:[],tenants:[],truckTypes:[],jobTypes:[],planStatus:[],aptStatus:[],ctnsizes:[],dgTypeList:[],zoneList:[],trafficDirs:[],loadStatusList:[],exTypes:[],entrys:[],releaseStatusList:[],trucks:[]}},methods:{deepMerge:function(t,e){var n;for(n in e)t[n]=t[n]&&"[object Object]"===t[n].toString()?this.deepMerge(t[n],e[n]):t[n]=e[n];return t},getUsers:function(t){var e=this;return new Promise((function(n,r){e.$api("/user/list",Object(a["a"])({},t)).then((function(t){e.users=t.users.list,n(t)})).catch((function(){r("api[getUsers]error")}))}))},getTenants:function(t){var e=this;return new Promise((function(n,a){var r=Object.assign({},t);e.$api("/gate/pomstenantcode/findAll",r).then((function(t){e.tenants=t.data,n(t)})).catch((function(){a("api[getTenants]error")}))}))},handleUserRemote:function(t){var e={realName:t};this.getUsers(e)},handleTenantRemote:function(t){var e={searchName:t};this.getTenants(e)},rowClassName:function(t){var e=t.row;t.rowIndex;return-1===e.passedFlag?"no-passed":1===e.passedFlag?"is-passed":""},getTruckTypes:function(){var t=this;return new Promise((function(e,n){t.$api("gate/lgtrucktype/findList",{}).then((function(n){t.truckTypes=n.data,e(n)})).catch((function(){n("api[getTruckTypes]error")}))}))},getJobTypes:function(){var t=this;return new Promise((function(e,n){t.$api("gate/pomsjobtype/findList",{}).then((function(n){t.jobTypes=n.data,e(n)})).catch((function(){n("api[getJobTypes]error")}))}))},getPlanStatus:function(){var t=this;return new Promise((function(e,n){t.$api("gate/pomsplan/status/list",{}).then((function(n){t.planStatus=n.data,e(n)})).catch((function(){n("api[getPlanStatus]error")}))}))},getAptStatus:function(){var t=this;return new Promise((function(e,n){t.$api("gate/pomsapt/status/list",{}).then((function(n){t.aptStatus=n.data,e(n)})).catch((function(){n("api[getJobTypes]error")}))}))},getCtnsizes:function(){var t=this;return new Promise((function(e,n){t.$api("gate/ctnsize/findAll",{}).then((function(n){t.ctnsizes=n.data,e(n)})).catch((function(){n("api[getCtnsizes]error")}))}))},getDgTreeList:function(){var t=this;return new Promise((function(e,n){t.$api("gate/lgdangertype/findTreeList",{}).then((function(n){t.dgTypeList=n.data,e(n)})).catch((function(){n("api[getDgTreeList]error")}))}))},getZoneTreeList:function(){var t=this;return new Promise((function(e,n){t.$api("gate/gbzone/findTreeList",{}).then((function(n){t.zoneList=n.data,e(n)})).catch((function(){n("api[getZoneTreeList]error")}))}))},getTrafficDirs:function(){var t=this;return new Promise((function(e,n){t.$api("gate/gatetraffic/trafficdir/findList",{}).then((function(n){t.trafficDirs=n.data,e(n)})).catch((function(){n("api[getTrafficDirs]error")}))}))},getLoadStatusList:function(){var t=this;return new Promise((function(e,n){t.$api("gate/gatetraffic/loadstatus/findList",{}).then((function(n){t.loadStatusList=n.data,e(n)})).catch((function(){n("api[getLoadStatusList]error")}))}))},getExTypes:function(){var t=this;return new Promise((function(e,n){t.$api("gate/gateextype/findAll",{}).then((function(n){t.exTypes=n.data,e(n)})).catch((function(){n("api[getExTypes]error")}))}))},getEntrys:function(){var t=this;return new Promise((function(e,n){t.$api("gate/gateentry/findAll",{}).then((function(n){t.entrys=n.data,e(n)})).catch((function(){n("api[getEntrys]error")}))}))},getReleaseStatusList:function(){var t=this;return new Promise((function(e,n){t.$api("gate/gatetraffic/releasestatus/findList",{}).then((function(n){t.releaseStatusList=n.data,e(n)})).catch((function(){n("api[getReleaseStatusList]error")}))}))},getTenantTrucks:function(t){var e=this;return new Promise((function(n,a){var r=Object.assign({},t);e.$api("/gate/pomstenanttruck/findAll",r).then((function(t){e.trucks=t.data,n(t)})).catch((function(){a("api[getTenantTrucks]error")}))}))}},filters:Object(a["a"])({},r)}},9571:function(t,e,n){"use strict";var a=n("4e54"),r=n.n(a);r.a},b90e:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"pager-wrap",staticStyle:{"text-align":"right"}},[n("div",{staticClass:"slot"},[t._t("default")],2),n("el-pagination",t._b({staticClass:"pager",attrs:{background:t.background,"current-page":t.source.pageIndex,"page-size":t.source.pageSize,"pager-count":5,layout:t.layout,"page-sizes":t.pageSizes,total:t.source.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}},"el-pagination",t.$attrs,!1))],1)},r=[],o=n("a534"),l={name:"pager",props:{source:{required:!0,type:o["a"]},pageSizes:{type:Array,default:function(){return[10,20,50,100]}},layout:{type:String,default:"slot, prev, pager, next, total, sizes, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},methods:{handleSizeChange:function(t){this.source.setPageSize(t),this.$emit("pagerChange",1)},handleCurrentChange:function(t){this.source.setPageIndex(t),this.$emit("pagerChange",t)}}},s=l,i=(n("9571"),n("e90a")),c=Object(i["a"])(s,a,r,!1,null,null,null);e["a"]=c.exports},bf4e:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form",{ref:"searchForm",staticClass:"search-form",attrs:{model:t.searchForm,inline:!0,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"业务类型",prop:"S_EQ_p__Job_Type_ID"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.searchForm.S_EQ_p__Job_Type_ID,callback:function(e){t.$set(t.searchForm,"S_EQ_p__Job_Type_ID",e)},expression:"searchForm.S_EQ_p__Job_Type_ID"}},[n("el-option",{attrs:{value:""}},[t._v("全部")]),t._l(t.jobTypes,(function(t){return n("el-option",{key:t.jobTypeId,attrs:{label:t.jobTypeName,value:t.jobTypeId}})}))],2)],1),n("el-form-item",{attrs:{label:"任务时间",prop:"estTime"}},[n("el-date-picker",{attrs:{type:"daterange",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchForm.estTime,callback:function(e){t.$set(t.searchForm,"estTime",e)},expression:"searchForm.estTime"}})],1),n("el-form-item",{attrs:{label:"状态",prop:"S_EQ_p__Status"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.searchForm.S_EQ_p__Status,callback:function(e){t.$set(t.searchForm,"S_EQ_p__Status",e)},expression:"searchForm.S_EQ_p__Status"}},[n("el-option",{attrs:{value:""}},[t._v("全部")]),t._l(t.planStatus,(function(t){return n("el-option",{key:t.status,attrs:{label:t.name,value:t.status}})}))],2)],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.onSearch(1)}}},[t._v("查询")]),n("el-button",{attrs:{type:"default",icon:"el-icon-refresh"},on:{click:function(e){return t.resetForm("searchForm")}}},[t._v("重置")])],1)],1),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.source.loading,expression:"source.loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:t.source.data,"highlight-current-row":"",border:"",stripe:""},on:{"current-change":t.handleRowChange}},[n("el-table-column",{attrs:{width:"40px",label:" ",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-radio",{staticClass:"no-label-radio",attrs:{label:e.$index},model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}})]}}])}),n("el-table-column",{attrs:{type:"index",width:"60px",label:"序号",index:function(t){return t+1},align:"center"}}),n("el-table-column",{attrs:{label:"提单号",prop:"blNo","header-align":"center","min-width":"150px"}}),n("el-table-column",{attrs:{label:"计划号",prop:"planNo","header-align":"center",align:"center","min-width":"110px"}}),n("el-table-column",{attrs:{label:"任务码",prop:"jobCode","header-align":"center","min-width":"140px","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.pomsPlanJobs,(function(a,r){return n("span",{key:a.jobCode},[t._v(" "+t._s(a.jobCode)+" "),r!=e.row.pomsPlanJobs.length-1?n("span",[t._v(",")]):t._e()])}))}}])}),n("el-table-column",{attrs:{label:"业务类型",prop:"jobTypeId","header-align":"center",align:"center","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(null==e.row.jobType?null:e.row.jobType.jobTypeName))]}}])}),n("el-table-column",{attrs:{label:"计划作业数",prop:"planJobs","header-align":"center",align:"center","min-width":"110px"}}),n("el-table-column",{attrs:{label:"预配作业数",prop:"allocatedJobs","header-align":"center",align:"center","min-width":"110px"}}),n("el-table-column",{attrs:{label:"完成作业数",prop:"doneJobs","header-align":"center",align:"center","min-width":"110px"}}),n("el-table-column",{attrs:{label:"计划提箱时间",prop:"estStart","header-align":"center",align:"center",width:"280px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("FormatDate")(e.row.estStart,"yy-MM-dd HH:mm"))+" 至 "+t._s(t._f("FormatDate")(e.row.estEnd,"yy-MM-dd HH:mm"))+" ")]}}])}),n("el-table-column",{attrs:{label:"计划状态",prop:"status","header-align":"center",align:"center","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("statusFilter")(e.row.status,t.planStatus)))]}}])}),n("el-table-column",{attrs:{label:"操作",width:"60",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"primary",circle:"",plain:"",icon:"el-icon-edit",title:"分配"},nativeOn:{click:function(n){return n.preventDefault(),t.rowEdit(e)}}})]}}])})],1),n("pager",{attrs:{source:t.source},on:{pagerChange:t.onSearch}}),n("el-divider",{attrs:{"content-position":"left"}},[t._v("预约明细")]),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.aptSource.loading,expression:"aptSource.loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:t.aptSource.data,border:"",stripe:""}},[n("el-table-column",{attrs:{type:"index",width:"80",label:"序号",index:function(t){return t+1},align:"center"}}),n("el-table-column",{attrs:{label:"车队",prop:"tenantName","header-align":"center","min-width":"130px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(null==e.row.tenant?null:e.row.tenant.tenantName))]}}])}),n("el-table-column",{attrs:{label:"箱尺寸",prop:"sizeCode","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.sizeName))]}}])}),n("el-table-column",{attrs:{label:"箱数",prop:"aptJobs","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"完成箱数",prop:"allocatedJobs","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"预约提箱时间",prop:"estStart","header-align":"center",align:"center","min-width":"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("FormatDate")(e.row.estStart,"yy-MM-dd HH:mm"))+" 至 "+t._s(t._f("FormatDate")(e.row.estEnd,"yy-MM-dd HH:mm"))+" ")]}}])}),n("el-table-column",{attrs:{label:"计划状态",prop:"status","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("statusFilter")(e.row.status,t.aptStatus)))]}}])}),n("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[4!=e.row.status?n("el-button",{attrs:{type:"primary",circle:"",plain:"",icon:"el-icon-edit",title:"修改"},nativeOn:{click:function(n){return n.preventDefault(),t.rowAptEdit(e)}}}):t._e(),4!=e.row.status?n("el-button",{attrs:{type:"primary",circle:"",plain:"",icon:"el-icon-view",title:"详情"},nativeOn:{click:function(n){return n.preventDefault(),t.rowAptView(e)}}}):t._e()]}}])})],1),t.formEdit.show?n("edit",{attrs:{model:t.formEdit},on:{close:t.onSearch}}):t._e(),t.formView.show?n("view-form",{attrs:{model:t.formView}}):t._e()],1)},r=[],o=(n("af82"),n("c354"),n("9a14"),n("b90e")),l=n("872c"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{title:null!=this.model.planId?"分配":"修改",visible:t.model.show,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.model,"show",e)}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"ruleForm",staticClass:"edit-form",attrs:{"label-width":"120px",model:t.ruleForm,rules:t.rules},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSave()}}},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:6}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"计划号"}},[t._v(t._s(t.ruleForm.planNo))])],1),n("el-col",{attrs:{span:6}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"提单号"}},[t._v(t._s(t.ruleForm.blNo))])],1),n("el-col",{attrs:{span:6}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"业务类型"}},[t._v(t._s(null==t.ruleForm.jobType?null:t.ruleForm.jobType.jobTypeName))])],1)],1),n("el-row",[n("el-col",{attrs:{span:6}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"待提箱数"}},[t._v(t._s(t.ruleForm.planJobs-(null==t.ruleForm.allocatedJobs?0:t.ruleForm.allocatedJobs)))])],1),n("el-col",{attrs:{span:12}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"预约提箱时间"}},[t._v(" "+t._s(t._f("FormatDate")(t.ruleForm.estStart,"yy-MM-dd HH:mm"))+" 至 "+t._s(t._f("FormatDate")(t.ruleForm.estEnd,"yy-MM-dd HH:mm"))+" ")])],1)],1),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-form-item",{attrs:{label:"调度车队",prop:"tenantId"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择",filterable:"","filter-method":t.tenantFilter},model:{value:t.ruleForm.tenantId,callback:function(e){t.$set(t.ruleForm,"tenantId",e)},expression:"ruleForm.tenantId"}},t._l(t.queryTenants,(function(t){return n("el-option",{key:t.tenantId,attrs:{label:t.tenantName,value:t.tenantId}})})),1)],1)],1)],1),n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{span:16}},[n("el-divider",{attrs:{"content-position":"left"}},[t._v("箱任务")]),n("el-row",[n("el-col",{attrs:{span:10}},[n("el-form-item",{attrs:{label:"","label-width":"0"}},[n("el-radio-group",{on:{change:function(e){return t.handleRadioCtnr(e)}},model:{value:t.ctnrRadio,callback:function(e){t.ctnrRadio=e},expression:"ctnrRadio"}},[n("el-radio",{attrs:{disabled:t.radioCtnr,label:1}},[t._v("计划箱数")]),n("el-radio",{attrs:{disabled:t.radioCtnrNo,label:2}},[t._v("限定箱号")])],1)],1)],1),2==t.isCtnr?n("el-col",{attrs:{span:12}},[n("el-form-item",{attrs:{label:"提箱尺寸",prop:"ctnsizeId"}},[n("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:t.handleSizeChange},model:{value:t.ruleForm.ctnsizeId,callback:function(e){t.$set(t.ruleForm,"ctnsizeId",e)},expression:"ruleForm.ctnsizeId"}},t._l(t.ctnsizes,(function(t){return n("el-option",{key:t.ctnsizeId,attrs:{label:t.sizeName,value:t.ctnsizeId}})})),1)],1)],1):t._e(),1==t.isCtnr?n("el-col",{attrs:{span:24}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.ctnrs.loading,expression:"ctnrs.loading"}],ref:"ctnrTable",staticClass:"edit-table",staticStyle:{width:"100%"},attrs:{data:t.ctnrs.data,border:"",stripe:"","highlight-current-row":"","cell-style":t.cellStyle},on:{"current-change":t.handleCtnrChange}},[n("el-table-column",{attrs:{type:"index",width:"60",label:"序号",index:function(t){return t+1},align:"center"}}),n("el-table-column",{attrs:{label:"待提箱型",prop:"typeCode","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"计划箱数",prop:"planLimit","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"待提箱数",prop:"noUseJobs","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"确认提箱数",prop:"aptJobs","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-form-item",{attrs:{"label-width":"0"}},[n("el-input",{staticStyle:{width:"100%"},on:{input:function(n){return t.handleAptJobsChange(n,e.row)}},model:{value:e.row.aptJobs,callback:function(n){t.$set(e.row,"aptJobs",n)},expression:"scope.row.aptJobs"}})],1)]}}],null,!1,307901394)})],1)],1):t._e(),2==t.isCtnr?n("el-col",{attrs:{span:24}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.ctnrnos.loading,expression:"ctnrnos.loading"}],ref:"ctnrnoTable",staticStyle:{width:"100%"},attrs:{data:t.ctnrnos.data,border:"",stripe:""},on:{"selection-change":t.handleCtnrNoChange}},[n("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),n("el-table-column",{attrs:{type:"index",width:"60",label:"序号",index:function(t){return t+1},align:"center"}}),n("el-table-column",{attrs:{label:"待提箱型",prop:"typeCode","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"待提箱号",prop:"ctnrNo","header-align":"center"}})],1)],1):t._e()],1)],1),n("el-col",{attrs:{span:8}},[n("el-divider",{attrs:{"content-position":"left"}}),n("el-row",[n("el-col",{attrs:{span:10}},[n("el-form-item",{attrs:{label:"票号选择","label-width":"70px"}})],1),n("el-col",{attrs:{span:24}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.aptJobCodes.loading,expression:"aptJobCodes.loading"}],ref:"jobcodeTable",staticStyle:{width:"100%"},attrs:{data:t.aptJobCodes.data,border:"",stripe:""},on:{"selection-change":t.handleJobCodeChange}},[n("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),n("el-table-column",{attrs:{type:"index",width:"60",label:"序号",index:function(t){return t+1},align:"center"}}),n("el-table-column",{attrs:{label:"待选票号",prop:"jobCode","header-align":"center",align:"center"}})],1)],1)],1)],1)],1)],1),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{icon:"el-icon-check",type:"primary"},on:{click:function(e){return t.handleSave()}}},[t._v("保存")]),n("el-button",{attrs:{icon:"el-icon-close"},on:{click:function(e){t.model.show=!1}}},[t._v("关闭")])],1)],1)},i=[],c=(n("86dd"),n("4045"),{name:"EditForm",props:["model"],mixins:[l["a"]],data:function(){return{loading:!0,tenants:[],queryTenants:[],ctnsizes:[],ctnrRadio:1,radioCtnr:!1,radioCtnrNo:!0,isCtnr:1,ruleForm:{},ctnrs:{loading:!0,data:[],value:null},ctnrnos:{loading:!0,data:[],value:[]},planCtnrnos:[],aptJobCodes:{loading:!0,data:[],value:[]},jobcodes:[],rules:{tenantId:[{required:!0,message:"租户代号不能为空",trigger:"change"}],ctnsizeId:[{required:!0,message:"箱尺码不能为空",trigger:"change"}]}}},created:function(){var t=this;this.getTenants({}).then((function(){t.tenantFilter("")})),null!=this.model.planNo?this.queryInfoByPlanNo(this.model.planNo):null!=this.model.aptId?this.queryInfoByAptId(this.model.aptId):(this.loading=!1,this.ctnrs.loading=!1,this.ctnrnos.loading=!1,this.aptJobCodes.loading=!1)},methods:{queryInfoByPlanNo:function(t){var e=this;this.$api("gate/pomsplan/info/planno/"+t,{}).then((function(t){if(e.loading=!1,e.ctnrs.loading=!1,e.ctnrnos.loading=!1,e.aptJobCodes.loading=!1,e.ctnrs.value=null,e.ctnrnos.value=[],e.aptJobCodes.value=[],0==t.code)if(e.ruleForm=t.data,e.ctnrs.data=e.ruleForm.pomsPlanCtnrs,e.aptJobCodes.data=e.ruleForm.pomsJobCodes,e.jobcodes=e.ruleForm.pomsJobCodes,e.planCtnrnos=e.ruleForm.pomsPlanCtnrnos,e.ctnrnos.data=e.planCtnrnos,null!=e.ctnrs.data&&e.ctnrs.data.length>0?(e.radioCtnr=!1,e.ctnrRadio=1,e.handleRadioCtnr(1)):e.radioCtnr=!0,null!=e.ctnrnos.data&&e.ctnrnos.data.length>0){e.radioCtnrNo=!1,e.radioCtnr&&(e.ctnrRadio=2,e.handleRadioCtnr(2));var n=[];e.planCtnrnos.forEach((function(t){var e=n.filter((function(e){return e.ctnsizeId==t.ctnsizeId}));0==e.length&&n.push({ctnsizeId:t.ctnsizeId,sizeCode:t.sizeCode,sizeName:t.sizeName})})),e.ruleForm.ctnsizeId=n[0].ctnsizeId,e.ctnsizes=n}else e.radioCtnrNo=!0})).catch((function(t){e.$alert(t,{lockScroll:!1,callback:function(t){e.loading=!1,e.ctnrs.loading=!1,e.ctnrnos.loading=!1,e.aptJobCodes.loading=!1,e.model.show=!1}})}))},queryInfoByAptId:function(t){var e=this;this.$api("gate/pomsapt/info/"+t,{}).then((function(t){if(e.loading=!1,e.ctnrs.loading=!1,e.ctnrnos.loading=!1,e.aptJobCodes.loading=!1,0==t.code){e.ruleForm=t.data,e.ctnrs.data=e.ruleForm.planCtnrs,e.ctnrs.data.forEach((function(t){t.isSelect&&(e.ctnrs.value=t)})),e.planCtnrnos=e.ruleForm.planCtnrnos,e.ctnrnos.data=e.planCtnrnos.filter((function(t){return t.ctnsizeId==e.ruleForm.ctnsizeId}));var n=[];e.ctnrnos.data.forEach((function(t){t.isSelect&&e.ctnrnos.value.push(t);var a=n.filter((function(e){return e.ctnsizeId==t.ctnsizeId}));0==a.length&&n.push({ctnsizeId:t.ctnsizeId,sizeCode:t.sizeCode,sizeName:t.sizeName})})),e.ctnsizes=n,e.jobcodes=e.ruleForm.pomsJobcodes,e.aptJobCodes.data=e.jobcodes.filter((function(t){return null==t.ctnsizeId||t.ctnsizeId==e.ruleForm.ctnsizeId})),e.aptJobCodes.data.forEach((function(t){t.aptId==e.ruleForm.aptId&&e.$nextTick((function(){e.$refs.jobcodeTable.toggleRowSelection(t)}))})),null!=e.ctnrs.data&&e.ctnrs.data.length>0?e.radioCtnr=!1:e.radioCtnr=!0,null!=e.ctnrnos.data&&e.ctnrnos.data.length>0?e.radioCtnrNo=!1:e.radioCtnrNo=!0,e.ruleForm.lineNo?e.radioCtnr||(e.ctnrRadio=1,e.handleRadioCtnr(1)):e.radioCtnrNo||(e.ctnrRadio=2,e.handleRadioCtnr(2))}})).catch((function(t){e.$alert(t,{lockScroll:!1,callback:function(t){e.loading=!1,e.ctnrs.loading=!1,e.ctnrnos.loading=!1,e.aptJobCodes.loading=!1,e.model.show=!1}})}))},tenantFilter:function(t){t=t.toLowerCase(),this.queryTenants=this.tenants.filter((function(e){return null!=e.tenantCode&&e.tenantCode.toLowerCase().indexOf(t)>-1||e.tenantName.toLowerCase().indexOf(t)>-1||null!=e.qsCode1&&e.qsCode1.toLowerCase().indexOf(t)>-1||null!=e.qsCode2&&e.qsCode2.toLowerCase().indexOf(t)>-1}))},handleRadioCtnr:function(t){var e=this;this.isCtnr=t,1==t?this.$nextTick((function(){e.$refs.ctnrTable.setCurrentRow(e.ctnrs.value)})):2==t&&this.ctnrnos.value.forEach((function(t){e.$nextTick((function(){e.$refs.ctnrnoTable.toggleRowSelection(t)}))}))},handleSizeChange:function(t){this.ctnrnos.data=this.planCtnrnos.filter((function(e){return null==e.ctnsizeId||e.ctnsizeId==t})),this.ctnrnos.value=[]},handleCtnrChange:function(t){t&&(null!=this.ruleForm.lineNo&&this.ruleForm.lineNo==t.lineNo&&(t.aptJobs=this.ruleForm.aptJobs),null==t.aptJobs&&(t.aptJobs=t.noUseJobs),this.ctnrs.value=t,this.jobCodeSelected(t.ctnsizeId,t.aptJobs),this.ctnrs.data.forEach((function(e){e.lineNo!=t.lineNo&&(e.aptJobs=null)})))},handleAptJobsChange:function(t,e){t>e.noUseJobs?(this.$message({message:"预约数不能大于可预约数。",type:"warning"}),e.aptJobs=e.noUseJobs):e.aptJobs=t,this.jobCodeSelected(e.ctnsizeId,e.aptJobs),this.$forceUpdate()},handleCtnrNoChange:function(t){this.ctnrnos.value=t,this.jobCodeSelected(t.ctnsizeId,this.ctnrnos.value.length)},handleJobCodeChange:function(t){this.aptJobCodes.value=t},jobCodeSelected:function(t,e){var n=this;this.aptJobCodes.data=this.jobcodes.filter((function(e){return null==e.ctnsizeId||e.ctnsizeId==t})),this.$refs.jobcodeTable.clearSelection(),this.aptJobCodes.data.forEach((function(t,a){a<e&&n.$nextTick((function(){n.$refs.jobcodeTable.toggleRowSelection(t,!0)}))}))},handleSave:function(){var t=this;this.$refs["ruleForm"].validate((function(e){if(e){var n=new Object;if(n.aptId=t.model.aptId,n.planId=t.ruleForm.planId,n.planJobs=t.ruleForm.planJobs,n.jobTypeId=t.ruleForm.jobTypeId,n.tenantId=t.ruleForm.tenantId,n.ctnsizeId=t.ruleForm.ctnsizeId,n.isAutoApt=null==t.ruleForm.isAutoApt?0:t.ruleForm.isAutoApt,n.estStartStr=t.ruleForm.estStart,n.estEndStr=t.ruleForm.estEnd,1==t.ctnrRadio){if(null==t.ctnrs.value)return void t.$error("请选择要预约的箱型箱数。");n.lineNo=t.ctnrs.value.lineNo,n.aptJobs=t.ctnrs.value.aptJobs,n.ctnsizeId=t.ctnrs.value.ctnsizeId}else if(2==t.ctnrRadio){if(0==t.ctnrnos.value.length)return void t.$error("请选择要预约的箱号。");n.aptJobs=t.ctnrnos.value.length,n.aptCtnrs=t.ctnrnos.value}if(0==t.aptJobCodes.value.length)return void t.$error("请选择要票号。");n.aptJobcodes=t.aptJobCodes.value;var a=t.$load("保存中"),r="gate/pomsapt/save";null!=t.model.aptId&&(r="gate/pomsapt/update"),t.$api(r,n).then((function(e){a.close(),null!=t.model.aptId?(t.model.show=!1,t.$emit("close")):t.queryInfoByPlanNo(t.model.planNo)})).catch((function(){a.close()}))}}))},cellStyle:function(t){var e=t.row;t.column,t.rowIndex,t.columnIndex;return null!=this.ctnrs.value&&this.ctnrs.value.lineNo==e.lineNo?"background-color: #1fb562; color: #fff;":""}}}),d=c,u=n("e90a"),p=Object(u["a"])(d,s,i,!1,null,null,null),m=p.exports,f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{attrs:{title:"详情",visible:t.model.show,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.model,"show",e)}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"ruleForm",attrs:{"label-width":"120px",model:t.ruleForm}},[n("el-row",[n("el-col",{attrs:{span:8}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"计划号"}},[t._v(t._s(t.ruleForm.planNo))])],1),n("el-col",{attrs:{span:8}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"提单号"}},[t._v(t._s(t.ruleForm.blNo))])],1),n("el-col",{attrs:{span:8}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"业务类型"}},[t._v(t._s(null==t.ruleForm.jobType?null:t.ruleForm.jobType.jobTypeName))])],1)],1),n("el-row",[n("el-col",{attrs:{span:8}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"箱尺寸"}},[t._v(t._s(t.ruleForm.sizeCode))])],1),n("el-col",{attrs:{span:16}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"预约提箱时间"}},[t._v(" "+t._s(t._f("FormatDate")(t.ruleForm.estStart,"yy-MM-dd HH:mm"))+" 至 "+t._s(t._f("FormatDate")(t.ruleForm.estEnd,"yy-MM-dd HH:mm"))+" ")])],1)],1),n("el-row",[n("el-col",{attrs:{span:8}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"车队"}},[t._v(t._s(null==t.ruleForm.tenant?null:t.ruleForm.tenant.tenantName))])],1),n("el-col",{attrs:{span:8}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"计划箱数"}},[t._v(t._s(t.ruleForm.aptJobs))])],1),n("el-col",{attrs:{span:8}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"已完成箱数"}},[t._v(t._s(t.ruleForm.allocatedJobs))])],1)],1),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"提箱小票"}},t._l(t.ruleForm.aptJobcodes,(function(e){return n("span",{key:e.jobCode,staticStyle:{"padding-right":"10px"}},[t._v(t._s(e.jobCode))])})),0)],1)],1),n("el-divider",{attrs:{"content-position":"left"}},[t._v("已完成任务")]),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-table",{ref:"jobTable",staticStyle:{width:"100%"},attrs:{data:t.ruleForm.pomsJobs,border:"",stripe:""}},[n("el-table-column",{attrs:{type:"index",width:"60",label:"序号",index:function(t){return t+1},align:"center"}}),n("el-table-column",{attrs:{label:"箱号",prop:"ctnrNo","header-align":"center"}}),n("el-table-column",{attrs:{label:"箱型",prop:"typeCode","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"车牌",prop:"truckNo","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"作业时间",prop:"createdTime","header-align":"center",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("FormatDate")(e.row.createdTime,"yy-MM-dd HH:mm")))]}}])})],1)],1)],1),n("el-divider",{attrs:{"content-position":"left"}},[t._v("待完成任务")]),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-table",{ref:"unjobTable",staticStyle:{width:"100%"},attrs:{data:t.ruleForm.unJobs,border:"",stripe:""}},[n("el-table-column",{attrs:{type:"index",width:"60",label:"序号",index:function(t){return t+1},align:"center"}}),n("el-table-column",{attrs:{label:"箱号",prop:"ctnrNo","header-align":"center"}}),n("el-table-column",{attrs:{label:"箱型",prop:"ctnIsoType","header-align":"center",align:"center"}}),n("el-table-column",{attrs:{label:"数量",prop:"aptJobs","header-align":"center",align:"center"}})],1)],1)],1)],1),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{icon:"el-icon-close"},on:{click:function(e){t.model.show=!1}}},[t._v("关闭")])],1)],1)},h=[],b={name:"ViewForm",props:["model"],data:function(){return{loading:!0,ruleForm:{aptJobcodes:[],pomsJobs:[],unJobs:[]}}},created:function(){var t=this;null!=this.model.aptId?this.$api("gate/pomsapt/info/"+this.model.aptId,{}).then((function(e){t.loading=!1,0==e.code&&(t.ruleForm=e.data)})):this.loading=!1},methods:{}},g=b,_=Object(u["a"])(g,f,h,!1,null,null,null),v=_.exports,y={name:"PomsPlan",components:{pager:o["a"],edit:m,viewForm:v},mixins:[l["a"]],data:function(){return{radio:null,searchForm:{S_EQ_p__Job_Type_ID:null,S_EQ_p__Status:1,estTime:[]},source:this.$tableSource("gate/pomsplan/list","data"),aptSearchForm:{},aptSource:this.$tableSource("gate/pomsapt/list","data"),jobTypes:[],planStatus:[],aptStatus:[],formEdit:{show:!1},formView:{show:!1}}},created:function(){this.onSearch(1),this.getJobTypes(),this.getPlanStatus(),this.getAptStatus()},methods:{onSearch:function(t){var e=Object.assign({},this.searchForm);null!=e.estTime&&e.estTime.length>0&&(e.S_GE_p__EST_Start=e.estTime[0],e.S_LE_p__EST_End=e.estTime[1]),this.source.setParams(e).setPageIndex(t).load(),this.handleRowChange()},resetForm:function(t){this.$refs[t].resetFields(),this.onSearch(1)},handleRowChange:function(t){t?(this.radio=t.index,this.aptSearchForm={S_EQ_apt__Plan_ID:t.planId,S_EQ_apt__Tenant_ID:this.$store.state.user.tenantId,S_NE_apt__Status:4},this.aptSource.setParams(this.aptSearchForm).setPageIndex(1).setPageSize(1e3).load()):(this.radio=null,this.aptSource.data=[])},rowEdit:function(t){var e=this;this.$api("gate/pomsplan/check/planno/"+t.row.planNo,{}).then((function(n){e.formEdit={show:!0,planNo:t.row.planNo}}))},rowAptEdit:function(t){this.formEdit={show:!0,aptId:t.row.aptId}},rowAptView:function(t){this.formView={show:!0,aptId:t.row.aptId}}},filters:{statusFilter:function(t,e){var n="";return e.forEach((function(e){if(e.status==t)return n=e.name,!1})),n}}},w=y,S=Object(u["a"])(w,a,r,!1,null,null,null);e["default"]=S.exports}}]);